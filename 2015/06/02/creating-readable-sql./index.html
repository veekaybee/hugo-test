<!doctype html><html lang=en-us>
<head>
<meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett">
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel="shortcut icon" href=https://veekaybee.github.io/hugo-test/images/favicon.png>
<title>Creating readable SQL. | ★★Vicki Boykis★★</title>
<meta name=title content="Creating readable SQL.">
<meta name=description content="Writing legible code is seen as the hallmark of a competent developer, and for good reason. If you can&rsquo;t read what you wrote, you can&rsquo;t change what you wrote. There are lots of organizations, especially once you get to larger companies where programming isn&rsquo;t the core competency or value center, that are prime examples of this. The result is a mess that not only impacts the code, but the entire company or business.">
<meta name=keywords content>
<meta property="og:title" content="Creating readable SQL.">
<meta property="og:description" content="Writing legible code is seen as the hallmark of a competent developer, and for good reason. If you can&rsquo;t read what you wrote, you can&rsquo;t change what you wrote. There are lots of organizations, especially once you get to larger companies where programming isn&rsquo;t the core competency or value center, that are prime examples of this. The result is a mess that not only impacts the code, but the entire company or business.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://veekaybee.github.io/hugo-test/2015/06/02/creating-readable-sql./"><meta property="og:image" content="https://veekaybee.github.io/hugo-test/images/share.png"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2015-06-02T00:00:00+00:00">
<meta property="article:modified_time" content="2015-06-02T00:00:00+00:00"><meta property="og:site_name" content="Hugo ʕ•ᴥ•ʔ Bear">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://veekaybee.github.io/hugo-test/images/share.png">
<meta name=twitter:title content="Creating readable SQL.">
<meta name=twitter:description content="Writing legible code is seen as the hallmark of a competent developer, and for good reason. If you can&rsquo;t read what you wrote, you can&rsquo;t change what you wrote. There are lots of organizations, especially once you get to larger companies where programming isn&rsquo;t the core competency or value center, that are prime examples of this. The result is a mess that not only impacts the code, but the entire company or business.">
<meta itemprop=name content="Creating readable SQL.">
<meta itemprop=description content="Writing legible code is seen as the hallmark of a competent developer, and for good reason. If you can&rsquo;t read what you wrote, you can&rsquo;t change what you wrote. There are lots of organizations, especially once you get to larger companies where programming isn&rsquo;t the core competency or value center, that are prime examples of this. The result is a mess that not only impacts the code, but the entire company or business."><meta itemprop=datePublished content="2015-06-02T00:00:00+00:00">
<meta itemprop=dateModified content="2015-06-02T00:00:00+00:00">
<meta itemprop=wordCount content="1178"><meta itemprop=image content="https://veekaybee.github.io/hugo-test/images/share.png">
<meta itemprop=keywords content>
<meta name=referrer content="no-referrer-when-downgrade">
<style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style>
</head>
<body>
<header><a href=/hugo-test/ class=title>
<h2>★★Vicki Boykis★★</h2>
</a>
<nav><a href=/hugo-test/>Tech Blog</a>
<a href=/hugo-test/essays>Essays</a>
<a href=/hugo-test/index.xml>RSS</a>
<a href=https://www.twitter.com/vboykis>Twitter</a>
<a href=https://www.github.com/veekaybee>GitHub</a>
<a href=/hugo-test/about>About</a></nav>
</header>
<main>
<h1>Creating readable SQL.</h1>
<p>
<i>
<time datetime=2015-06-02 pubdate>
Jun 6 2015
</time>
</i>
</p>
<content>
<p><img src=https://raw.githubusercontent.com/veekaybee/veekaybee.github.io/master/images/bart.gif alt=Bart></p>
<p>Writing legible code is seen as the hallmark of a competent developer, and for good reason. If you can&rsquo;t read what you wrote, you can&rsquo;t change what you wrote. There are lots of organizations, especially once you get to larger companies where programming isn&rsquo;t the core competency or value center, that are prime examples of this. The result is a mess that not only impacts the code, but the entire company or business.</p>
<p>There are great essays and books on reproducible code in almost every imaginable compiled and interpreted language, from Python, to Java, and great generalist essays, like Knuth&rsquo;s on writing reproducible code.</p>
<p>But what about SQL, still the #1 data language of choice in 80% of the tech enterprise world?</p>
<h2 id=there-are-a-couple-problems-with-making-sql-legible>There are a couple problems with making SQL legible</h2>
<p>SQL is often the redheaded stepchild of computer languages.</p>
<p>First, because it&rsquo;s a declarative language, it&rsquo;s hard to do the same kind of concepts that are super-easy in almost any other language: loops, recursion, functions, or even declaring variables. You can do these things in T-SQL, but learning T-SQL and optimizing queries in it is almost not worth it if you just need to pull x dataset for sampling and want to spend most of your time in Python or R analyzing said data, or Y dataset with a,b,and c business logic requirements built in. As a result, it&rsquo;s hard to see SQL as logical and amenable to logical constraints or exceptions, as in &ldquo;regular&rdquo; languages. The other issue is that SQL is often seen as a necessary evil and developers often try to force their way through it in order to write ORMs instead of seeing it as a value-add for data teams.</p>
<p>Second, because it doesn&rsquo;t need to be written in a specific format, saved to an editor, or checked into repositories, SQL snippets often end up languishing in Oracle windows, Evernotes, text files in random project directories, and even in emails (guilty as charged -I&rsquo;ve used Outlook as a SQL query storage mechanism before.)</p>
<p>Even though there is a lot of hype about NoSQL data systems, most data scientists will tell you that they spend a <strong>LOT</strong> of time getting data sets ready in MySQL or Oracle or SQL Server or Postgres as part of their data flow.</p>
<p>Then these code snippets are usually stored away in everything from Word docs, to Evernotes, to text files in project directories. Because SQL is declarative and run one person at a time, most times, unless it&rsquo;s being run as part of a Python or R call through the respective APIs, it&rsquo;s not even put into version control.</p>
<p>But what about when SQL code needs to be stored or rerun? How to read the jumbled mess of nested subqueries and tons of case statements necessitated by the fact that the business logic for the data requires it?</p>
<p>Here are a couple tips from painful personal experience. All of these are guidelines, by the way, and geared towards data scientists/analysts working alone on manual SQL tasks that are not part of an automated data flow (but even in that case, cleaning up code will make other components easier to read, too)</p>
<p>The guidelines don&rsquo;t mean you have to use them every time. I&rsquo;ve personally written some pretty ugly, functional SQL when it was crunch time. But they will make your life prettier and easier. This is not specifically about optimizing SQL, which I&rsquo;ll cover in another post.</p>
<h2 id=how-to-make-sql-legible-to-other-humans>How to make SQL legible to other humans</h2>
<h3 id=1-make-all-declarative-keywords-their-own-new-line-if-possible-because-its-easier-to-read-and-understand-which-table-and-which-columns-are-being-referenced>1. Make all declarative keywords their own new line if possible because it&rsquo;s easier to read and understand which table and which columns are being referenced:</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>
<span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> tablex
<span style=color:#66d9ef>WHERE</span> variabley<span style=color:#f92672>=</span>z 
<span style=color:#66d9ef>AND</span> variablea<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>
<span style=color:#66d9ef>AND</span> variableb<span style=color:#f92672>=</span><span style=color:#ae81ff>15</span>
</code></pre></div><p>is more legible than</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>
<span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> tablex <span style=color:#66d9ef>where</span> variabley<span style=color:#f92672>=</span>z <span style=color:#66d9ef>AND</span> variablea<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span> <span style=color:#66d9ef>AND</span> variableb<span style=color:#f92672>=</span><span style=color:#ae81ff>15</span>
</code></pre></div><h3 id=2--make-all-declarative-statements-and-db-functions-uppercase>2. Make all declarative statements and DB functions uppercase</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>
<span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> tablex
<span style=color:#66d9ef>WHERE</span> variabley<span style=color:#f92672>=</span>z 
<span style=color:#66d9ef>AND</span> variablea<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>
<span style=color:#66d9ef>AND</span> variableb<span style=color:#f92672>=</span><span style=color:#ae81ff>15</span>
<span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> RAND()
<span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>1</span>
</code></pre></div><p>is more legible than</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>
<span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> tablex
<span style=color:#66d9ef>where</span> variabley<span style=color:#f92672>=</span>z 
<span style=color:#66d9ef>AND</span> variablea<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>
<span style=color:#66d9ef>AND</span> variableb<span style=color:#f92672>=</span><span style=color:#ae81ff>15</span>
<span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> RAND()
<span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>1</span>
</code></pre></div><p>It&rsquo;s easier to read all uppercase. Or, alternatively, if you don&rsquo;t have time (and it is kind of annoying to remember), make them all lowercase. Just don&rsquo;t mix cases. And uppercase is preferable in any kind of documentation. The same is true for tablenames. Make them either all lower case or all uppercase. Lowercase is preferable to avoid mixing them up with declaratives.</p>
<h3 id=3-try-to-limit-the-amount-of-subqueries-in-your-query>3. Try to limit the amount of subqueries in your query.</h3>
<p>Yes, subqueries are much, much faster if you&rsquo;re aggregating across multiple data sets. Check out <a href=https://www.periscope.io/blog/use-subqueries-to-count-distinct-50x-faster.html>this post</a> for more detail as to why. But when you get to the point where you have more than 4 subqueries, you probably want to do some optimization, or if possible, rebuild your tables in a way that makes more sense. If you find yourself CONSTANTLY having to write subqueries, it&rsquo;s a sign that your data schemas are architected incorrectly.</p>
<h3 id=4-include-comments>4. Include comments.</h3>
<p>Both in the beginning of the code snippet to say what data the snippet pulls, the business logic it includes, and throughout, as much as possible, to reference subqueries. SQL makes it hard to read through an entire piece of code without running specific pieces one by one to get where you&rsquo;re going and comments will help jog the memory. Include them at the end of lines in code, or in blocks at the beginning of code.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>
<span style=color:#75715e>/*Pulls a sample of 1000 random Nutella orders
</span><span style=color:#75715e> by month from the Northeast and excludes 16-oz sized jars. 
</span><span style=color:#75715e>Orders without monetary transactions are excluded, too. 
</span><span style=color:#75715e>Pulls into R script for regression analysis. */</span>	

<span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> trans a <span style=color:#75715e>--transactions table 
</span><span style=color:#75715e></span><span style=color:#66d9ef>JOIN</span> region b <span style=color:#75715e>--region table with 5 splits
</span><span style=color:#75715e></span><span style=color:#66d9ef>ON</span> a.trans_id<span style=color:#f92672>=</span>b.regionid
<span style=color:#66d9ef>WHERE</span> a.product_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;nutella&#39;</span>
<span style=color:#66d9ef>AND</span> b.regionid<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;NE&#39;</span> <span style=color:#75715e>--NE=northeast
</span><span style=color:#75715e></span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> RAND() <span style=color:#75715e>--selecting a random sample of 100
</span><span style=color:#75715e></span><span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>100</span>
</code></pre></div><h3 id=5-use-short-but-concise-table-aliases>5. Use short but concise table aliases</h3>
<p>You&rsquo;re probably doing a lot of joins. You want to see what those joins are doing. If you have a transactions_table, you don&rsquo;t want to alias it as transactions_table because that becomes too cluttered. Call it <code>trans</code>. <code>t</code> is too short and probably won&rsquo;t mean anything when you try to read the code back and translate it into business logic.</p>
<h3 id=6-use-indentation-if-you-have-multiple-subqueries-its-much-easier-to-read-where-the-subqueries-came-from>6. Use indentation. If you have multiple subqueries, it&rsquo;s much easier to read where the subqueries came from.</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>
<span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> tablex
<span style=color:#66d9ef>JOIN</span> 
   (<span style=color:#66d9ef>SELECT</span> a, b 
    <span style=color:#66d9ef>FROM</span> tabley
    <span style=color:#66d9ef>WHERE</span> x<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;5&#39;</span>) ysub
<span style=color:#66d9ef>WHERE</span> variabley<span style=color:#f92672>=</span>z 
<span style=color:#66d9ef>AND</span> variablea<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>
<span style=color:#66d9ef>AND</span> variableb<span style=color:#f92672>=</span><span style=color:#ae81ff>15</span>
<span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> RAND()
<span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>1</span>
</code></pre></div><p>is more legible than</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>
<span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> tablex
<span style=color:#66d9ef>JOIN</span> (<span style=color:#66d9ef>select</span> a, b <span style=color:#66d9ef>from</span> tabley <span style=color:#66d9ef>where</span> x<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;5&#39;</span>) ysub
<span style=color:#66d9ef>where</span> variabley<span style=color:#f92672>=</span>z 
<span style=color:#66d9ef>AND</span> variablea<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>
<span style=color:#66d9ef>AND</span> variableb<span style=color:#f92672>=</span><span style=color:#ae81ff>15</span>
<span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> RAND()
<span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>1</span>
</code></pre></div><h3 id=7-make-new-tables>7. Make new tables.</h3>
<p>If you find your query becoming longer than some random threshold you set for yourself, i.e. 15 lines or so AND you find yourself running it over and over, it&rsquo;s probably time to create a permanent table for your data.</p>
<p>Here&rsquo;s another great post I referenced while writing this one:</p>
<ul>
<li><a href=http://programmers.stackexchange.com/questions/144602/how-do-i-make-complex-sql-queries-easier-to-write>How do I make complex SQL queries easier to write? on Stack Overflow</a></li>
</ul>
</content>
<p>
</p>
</main>
<footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a>
</footer>
</body>
</html>