<!doctype html><html lang=en-us>
<head>
<meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett">
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel="shortcut icon" href=https://veekaybee.github.io/hugo-test/images/favicon.png>
<title>How to parse emails with Python (or, how I liberated my Strata schedule) | Hugo ʕ•ᴥ•ʔ Bear Blog</title>
<meta name=title content="How to parse emails with Python (or, how I liberated my Strata schedule)">
<meta name=description content="Strata, arguably the largest data science conference in the United States, is coming up in September and my company is sponsoring my trip there this year, so I&rsquo;ve started planning out which sessions I&rsquo;ll be attending.
One of the cool things you can do on the website for the conference is plan out your schedule beforehand by adding sessions to your calendar.
But I wanted to then share that calendar with a coworker who is also going and compare calendars with him.">
<meta name=keywords content>
<meta property="og:title" content="How to parse emails with Python (or, how I liberated my Strata schedule)">
<meta property="og:description" content="Strata, arguably the largest data science conference in the United States, is coming up in September and my company is sponsoring my trip there this year, so I&rsquo;ve started planning out which sessions I&rsquo;ll be attending.
One of the cool things you can do on the website for the conference is plan out your schedule beforehand by adding sessions to your calendar.
But I wanted to then share that calendar with a coworker who is also going and compare calendars with him.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://veekaybee.github.io/hugo-test/how-to-parse-emails-with-python-or-how-i-liberated-my-strata-schedule/"><meta property="og:image" content="https://veekaybee.github.io/hugo-test/images/share.png"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2016-08-28T00:00:00+00:00">
<meta property="article:modified_time" content="2016-08-28T00:00:00+00:00"><meta property="og:site_name" content="Hugo ʕ•ᴥ•ʔ Bear">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://veekaybee.github.io/hugo-test/images/share.png">
<meta name=twitter:title content="How to parse emails with Python (or, how I liberated my Strata schedule)">
<meta name=twitter:description content="Strata, arguably the largest data science conference in the United States, is coming up in September and my company is sponsoring my trip there this year, so I&rsquo;ve started planning out which sessions I&rsquo;ll be attending.
One of the cool things you can do on the website for the conference is plan out your schedule beforehand by adding sessions to your calendar.
But I wanted to then share that calendar with a coworker who is also going and compare calendars with him.">
<meta itemprop=name content="How to parse emails with Python (or, how I liberated my Strata schedule)">
<meta itemprop=description content="Strata, arguably the largest data science conference in the United States, is coming up in September and my company is sponsoring my trip there this year, so I&rsquo;ve started planning out which sessions I&rsquo;ll be attending.
One of the cool things you can do on the website for the conference is plan out your schedule beforehand by adding sessions to your calendar.
But I wanted to then share that calendar with a coworker who is also going and compare calendars with him."><meta itemprop=datePublished content="2016-08-28T00:00:00+00:00">
<meta itemprop=dateModified content="2016-08-28T00:00:00+00:00">
<meta itemprop=wordCount content="897"><meta itemprop=image content="https://veekaybee.github.io/hugo-test/images/share.png">
<meta itemprop=keywords content>
<meta name=referrer content="no-referrer-when-downgrade">
<style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style>
</head>
<body>
<header><a href=/hugo-test/ class=title>
<h2>Hugo ʕ•ᴥ•ʔ Bear Blog</h2>
</a>
<nav><a href=/hugo-test/>Home</a>
<a href=/hugo-test/bear/>Bear</a>
<a href=/hugo-test/blog>Blog</a>
</nav>
</header>
<main>
<h1>How to parse emails with Python (or, how I liberated my Strata schedule)</h1>
<p>
<i>
<time datetime=2016-08-28 pubdate>
28 Aug, 2016
</time>
</i>
</p>
<content>
<p><a href=http://conferences.oreilly.com/strata/hadoop-big-data-ny>Strata</a>, arguably the largest data science conference in the United States, is coming up in September and <a href=http://www.captechconsulting.com/>my company</a> is sponsoring my trip there this year, so I&rsquo;ve started planning out which sessions I&rsquo;ll be attending.</p>
<p>One of the cool things you can do on the website for the conference is <a href=http://conferences.oreilly.com/strata/hadoop-big-data-ny/public/schedule/grid/public/2016-09-27>plan out your schedule beforehand</a> by adding sessions to your calendar.</p>
<p>But I wanted to then share that calendar with a coworker who is also going and compare calendars with him. Sharing .ics files isn&rsquo;t really optimal for me because I didn&rsquo;t necessarily want our calendars overlapping in my work Outlook calendar; I just wanted to do a quick scan of sessions.</p>
<p><img src=https://raw.githubusercontent.com/veekaybee/strata_schedule/master/sessionscan.png alt=image></p>
<p>The best-case scenario would be something similar to a physical print-out, a generated screenshot of the whole page, which you can do with the Full <a href="https://chrome.google.com/webstore/detail/full-page-screen-capture/fdpohaocaechififmbbbbbknoalclacl/related?hl=en-US">Page Screen Capture extension in Chrome</a>.</p>
<p>But this would be hard to send/read, and to search for keywords. So my idea was to scrape the site for all of my session metadata.</p>
<p>Unfortunately, the O' Reilly site is very hard to scrape.</p>
<p><img src=https://raw.githubusercontent.com/veekaybee/strata_schedule/master/yuck.png alt=image></p>
<p>And I also didn&rsquo;t really want to <a href=http://stackoverflow.com/questions/2910221/how-can-i-login-to-a-website-with-python>mess with cookies</a>, a prereq for dealing with websites where you have login with a user id and password.</p>
<p>So I decided to parse the .ics file that gets generated when you download your schedule into human-readable text.</p>
<p>.ics is a calendar format supported by Google Calendar, Apple Calendar, and partially by Outlook. An ics file is a text file (utf-8) with a special format that has lines of content demarcated by the name, parameters, and values of a given field.</p>
<p>My Strata ics file looks like this:</p>
<pre><code>BEGIN:VCALENDAR
X-WR-CALNAME:Strata + Hadoop World in New York 2016
VERSION:2.0
PRODID:Expectnation
CALSCALE:GREGORIAN
BEGIN:VEVENT
DTEND;TZID=US/Eastern:20160928T120000
DTSTART;TZID=US/Eastern:20160928T112000
DTSTAMP:20160727T212110
LOCATION:Hall 1C
URL:http://conferences.oreilly.com/strata/hadoop-big-data-ny/public/schedule/detail/51777
UID:http://conferences.oreilly.com/strata-hadoop-big-data-ny--s2016-09-28-11:20--51777
SUMMARY:Why should I trust you? Explaining the predictions of machine-learning models
DESCRIPTION:Presented by Carlos Guestrin (Dato). Despite widespread adoption, machine-learning models remain mostly black boxes, making it very difficult to understand the reasons behind a prediction. Such understanding is fundamentally important to assess trust in a model before we takeactions based on a prediction or choose to deploy a new ML service. Carlos Guestrin offers a general approach for explaining predictions made by any ML model.
END:VEVENT
</code></pre>
<p>As you can see, the <code>VCALENDAR</code> is the overarching email enclosure, and each event begins with a <code>VEVENT</code> tag. I think of it as similar to HTML, where you have the tags as the outermost level, encolsing and tags. A <a href=https://tools.ietf.org/html/rfc2445#section-4.6.1>LOT more about it in the iCalendar spec</a>, but that&rsquo;s the basic gist of it.</p>
<p>The parts of the ical file are:</p>
<pre><code>NAME;paramters:values

Like so: 

DTEND;TZID=US/Eastern:20160928T120000
</code></pre>
<p>Fortunately, Python has a great library, <code>icalendar</code> <a href=http://icalendar.readthedocs.io/en/latest/usage.html>already pre-built with classes to parse ical</a> so you don&rsquo;t have to reinvent the wheel and write lots of regular expressions. So that&rsquo;s what I ended up using:</p>
<pre tabindex=0><code>
'''
Parse .ics file into human-readable text format
Original data from 
http://conferences.oreilly.com/strata/hadoop-big-data-ny/public/schedule/personal
Sorry PEP8
'''

from icalendar import Calendar, Event
from datetime import datetime
import glob, os


# date formats for DTSTART and END
start_format = &quot;%a %b %d %H:%M&quot;
end_format = &quot;%H:%M&quot; #only hour needed for end time


def parse_ics(infile):
	
	cal = Calendar.from_ical(infile.read())

	events = []

	for component in cal.walk('vevent'):
		event =   component.get('summary')
		description =  component.get('description')
		location =  component.get('location')
		start = component.get('dtstart')
		end = component.get('dtend')
		total_time =  &quot;%s-%s&quot; % (start.dt.strftime(start_format) , end.dt.strftime(end_format))
		line =  &quot;Summary:%s \nDescription: %s \nLocation: %s \nTime: %s \n------\n &quot; % (event, description, location, total_time)
		events.append(line)

	return events

def ics_to_file(filename, events):
	with open(filename, 'w') as f:
		for e in events:
			f.write(e.encode('utf-8')) #include correct encoding

def convert_file():
	for file in glob.glob(&quot;*.ics&quot;):
		outfilename = os.path.splitext(file)[0]
		infile = open(file, 'rb')
		parsed_results = parse_ics(infile)
		ics_to_file('%s.txt' % outfilename, parsed_results) 

if __name__ == '__main__':
	convert_file()
	
</code></pre><p>The code is pretty straight-forward. It takes all input files in the given active directory and generates output files, named with the same prefix as the input file, but outputting as a text file, that strips the .ics formatting into a more human-readable format.</p>
<p>The way it does this is by reading in a <code>Calendar()</code> object. <code>Calendar()</code> has a function called <code>walk</code> that loops through each event in the &lsquo;vevent&rsquo; sub-category and fetches the ones with the names I&rsquo;m interested in (like summary, for example). It then appends each compiled line into a list which is then read into a txt file.</p>
<p>The only tricky part here is the time. If you just do <code>component.get('dtstart')</code>, you get back a special object that looks something like this: <code>&lt;icalendar.prop.vDDDTypes object at 0x1035d5090></code>. That&rsquo;s because dates are special objects in ical and need to be <a href=http://stackoverflow.com/questions/20937754/parsing-ical-feed-with-python-using-icalendar>converted to datetimes</a> with the .dt function.</p>
<p>So here are the results for that earlier entry:</p>
<pre tabindex=0><code>Summary:Why should I trust you? Explaining the predictions of machine-learning models 
Description: Presented by Carlos Guestrin (Dato). Despite widespread adoption, machine-learning models remain mostly black boxes, making it very difficult to understand the reasons behind a prediction. Such understanding is fundamentally important to assess trust in a model before we take actions based on a prediction or choose to deploy a new ML service. Carlos Guestrin offers a general approach for explaining predictions made by any ML model. 
Location: Hall 1C 
Time: Wed Sep 28 11:20-12:00 
</code></pre><p>And the end result is an entire, readable, usable text file. It&rsquo;s no fancy social shared calendar or scheduling app, but it does the job in a pinch.</p>
<p>All of the <a href=https://github.com/veekaybee/strata_schedule>code and raw files are here</a>.</p>
</content>
<p>
</p>
</main>
<footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a>
</footer>
</body>
</html>